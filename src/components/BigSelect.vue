<template>
  <div class="text-left relative">
    <label class="text-gray-800 text-sm my-3 block">{{ name }}</label>
    <button
      class="
        text-left
        flex
        justify-between
        items-center
        border-1 border-gray-300
        px-2
        py-1
        rounded
        w-full
      "
      @click="isOpen = !isOpen"
      v-click-outside="() => (isOpen = false)"
    >
      <template v-if="selectedOptionObject">
        <img
          :src="
            logos[`../assets/logos/${selectedOptionObject.logo}.svg`]?.default
          "
          class="w-5 h-5 mr-3"
        />
        <span>
          {{ selectedOptionObject.name }}
        </span>
        <span
          v-if="selectedOptionObject.description"
          class="text-gray-400 ml-2"
        >
          {{ selectedOptionObject.description }}
        </span>
      </template>
      <span>
        {{ placeholder }}
      </span>
      <span class="flex-grow"></span>
      <FaIcon icon="chevron-down" size="xs" class="w-3 my-2 text-gray-500" />
    </button>
    <ul
      v-if="isOpen"
      class="
        w-full
        absolute
        p-2
        bg-white
        border-1 border-gray-300 border-t-gray-100
        rounded-b
        flex flex-col
        gap-3
        z-10
      "
      style="margin-top: -3px"
    >
      <li
        v-for="opt in options"
        :key="opt.id"
        @click="selectOption(opt)"
        focus="1"
        class="cursor-pointer flex items-center"
      >
        <img
          :src="logos[`../assets/logos/${opt.logo}.svg`]?.default"
          class="w-5 h-5 mr-3"
        />
        <span>
          {{ opt.name }}
        </span>
        <span v-if="opt.description" class="text-gray-400 ml-2">
          {{ opt.description }}
        </span>
      </li>
    </ul>
  </div>
</template>

<script lang="ts">
import { computed, defineComponent, PropType, Ref, ref } from "vue";

// FIXME: vite specific trick
const logos = import.meta.globEager("../assets/logos/*.svg");
interface Option {
  name: string;
  description?: string;
  logo: string;
  id: string;
}

export default defineComponent({
  emits: {
    select: null,
  },
  props: {
    name: {
      type: String,
      required: true,
    },
    value: {
      type: String,
      default: undefined,
    },
    placeholder: {
      type: String,
      default: undefined,
    },
    options: {
      type: Array as PropType<Array<Option>>,
      required: true,
    },
  },
  setup(props, { emit }) {
    const isOpen = ref(false);

    const selectedOptionObject = computed(() => {
      return props.options.find((opt) => opt.id === props.value);
    });

    const selectOption = (opt: Option) => {
      emit("select", opt);
    };

    return {
      logos,
      isOpen,
      selectedOptionObject,
      selectOption,
    };
  },
});
</script>
